### ğŸ“‹ **å®Œæ•´çš„Workspace SSEæ”¹é€ æ–‡æ¡£**

#### ğŸ”§ **å·²æ”¹é€ /éªŒè¯çš„æ–‡ä»¶**ï¼š

1. **âœ… `web/src/app/workspace/[traceId]/page.tsx`** - æ ¸å¿ƒSSEäº‹ä»¶å¤„ç†
   - æ·»åŠ äº†12ç§SSEäº‹ä»¶ç±»å‹å¤„ç†
   - ä¿®å¤äº†å­—æ®µæ˜ å°„é—®é¢˜
   - å¢å¼ºäº†metadataå­˜å‚¨

2. **âœ… `web/src/app/workspace/[traceId]/components/conversation-panel.tsx`** - å¯¹è¯é¢æ¿
   - æ­£ç¡®ä½¿ç”¨store hooksè·å–å®æ—¶æ•°æ®
   - æ”¯æŒæµå¼æ¶ˆæ¯æ˜¾ç¤º
   - è‡ªåŠ¨æ»šåŠ¨å’ŒçŠ¶æ€æŒ‡ç¤º

3. **âœ… `web/src/components/yadra/artifact-feed.tsx`** - å·¥ä»¶é¢æ¿
   - ç›´æ¥ä»SSE storeè·å–artifacts
   - å®æ—¶æ›´æ–°å’Œè¿‡æ»¤
   - æ— éœ€é¢å¤–æ”¹é€ 

4. **âœ… `web/src/app/workspace/[traceId]/components/output-stream.tsx`** - è¾“å‡ºæµé¢æ¿
   - å®Œæ•´çš„SSEå®æ—¶æ•°æ®æ”¯æŒ
   - äº‹ä»¶ç±»å‹è¯†åˆ«å’Œè¿‡æ»¤
   - è‡ªåŠ¨æ»šåŠ¨å’Œå®æ—¶äº¤äº’

5. **âœ… `web/src/app/workspace/[traceId]/components/search-panel.tsx`** - æœç´¢é¢æ¿
   - åŸºäºå®æ—¶æ¶ˆæ¯æ•°æ®æœç´¢
   - åŠ¨æ€æ›´æ–°å¯ç”¨é€‰é¡¹
   - å®æ—¶ç»“æœè®¡æ•°

6. **âœ… `web/src/app/workspace/[traceId]/components/podcast-panel.tsx`** - æ’­å®¢é¢æ¿
   - æ”¯æŒæµå¼æ’­å®¢ç”Ÿæˆ
   - å®æ—¶çŠ¶æ€æ›´æ–°
   - é”™è¯¯å¤„ç†

7. **âœ… `web/src/app/workspace/[traceId]/components/feedback-system.tsx`** - åé¦ˆç³»ç»Ÿ
   - çº¯UIç»„ä»¶ï¼Œé€šè¿‡çˆ¶ç»„ä»¶è·å–SSEæ•°æ®
   - æ”¯æŒå®æ—¶åé¦ˆæ›´æ–°

#### ğŸš€ **ä¸»è¦æ”¹è¿›æˆæœ**ï¼š

1. **å®Œæ•´çš„SSEäº‹ä»¶æ”¯æŒ**ï¼š
   - `navigation` - URLåˆ°thread_idæ˜ å°„
   - `node_start/complete` - èŠ‚ç‚¹æ‰§è¡ŒçŠ¶æ€
   - `plan_generated` - ç ”ç©¶è®¡åˆ’ç”Ÿæˆ
   - `search_results` - æœç´¢ç»“æœ
   - `agent_output` - ä»£ç†è¾“å‡º
   - `progress` - è¿›åº¦æ›´æ–°
   - `message_chunk` - æµå¼æ¶ˆæ¯
   - `artifact` - å·¥ä»¶ç”Ÿæˆ
   - `complete/error` - å®Œæˆå’Œé”™è¯¯äº‹ä»¶

2. **å®æ—¶æ•°æ®æµæ¶æ„**ï¼š
   - æ‰€æœ‰é¢æ¿ç»„ä»¶éƒ½ä½¿ç”¨unified-storeçš„hooks
   - è‡ªåŠ¨å“åº”SSEäº‹ä»¶æ›´æ–°
   - æ— éœ€æ‰‹åŠ¨åˆ·æ–°æˆ–è½®è¯¢

3. **å¢å¼ºçš„ç”¨æˆ·ä½“éªŒ**ï¼š
   - å®æ—¶çŠ¶æ€æŒ‡ç¤ºå™¨
   - è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°å†…å®¹
   - æµå¼æ¶ˆæ¯é«˜äº®æ˜¾ç¤º
   - äº‹ä»¶ç±»å‹å¯è§†åŒ–åŒºåˆ†

4. **å®Œæ•´çš„é”™è¯¯å¤„ç†**ï¼š
   - TypeScriptç±»å‹å®‰å…¨
   - ä¼˜é›…çš„é”™è¯¯çŠ¶æ€æ˜¾ç¤º
   - ç½‘ç»œæ–­çº¿é‡è¿æ”¯æŒ

### ğŸ¯ **æ¶æ„ä¼˜åŠ¿**ï¼š

1. **èŒè´£æ¸…æ™°åˆ†ç¦»**ï¼š
   - å‰ç«¯å®Œå…¨ä½¿ç”¨SSEå®æ—¶æ•°æ®
   - åç«¯ç¡®ä¿SSEäº‹ä»¶æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
   - å®æ—¶å’Œå†å²æ•°æ®å®Œå…¨ä¸€è‡´

2. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å®æ—¶é¡µé¢æ— æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ
   - äº‹ä»¶é©±åŠ¨çš„æ›´æ–°æœºåˆ¶
   - æœ€å°åŒ–é‡æ¸²æŸ“

3. **å¯æ‰©å±•æ€§**ï¼š
   - æ–°çš„SSEäº‹ä»¶ç±»å‹æ˜“äºæ·»åŠ 
   - ç»„ä»¶å¤ç”¨æ€§é«˜
   - ç»Ÿä¸€çš„æ•°æ®æµç®¡ç†

### æ”¹é€ åçš„SSEæ•°æ®æµæ¶æ„

Ran tool
Ran tool
Ran tool
Ran tool
Ran tool
æˆ‘éœ€è¦ä»”ç»†åˆ†æSSEæ•°æ®æµæ¶æ„ã€‚è®©æˆ‘ä»unified-storeå¼€å§‹è¿½è¸ªï¼š
Read file: web/src/core/store/unified-store.ts
è®©æˆ‘ç»§ç»­æŸ¥çœ‹storeä¸­çš„å…³é”®æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯æ¶ˆæ¯æ·»åŠ å’ŒSSEå¤„ç†ï¼š
Read file: web/src/core/store/unified-store.ts
ç°åœ¨è®©æˆ‘æŸ¥çœ‹å…³é”®çš„SSEå¤„ç†æ¨¡å—ï¼š
Read file: web/src/core/api/research-stream.ts
ç°åœ¨è®©æˆ‘æŸ¥çœ‹æœ€åº•å±‚çš„SSEå¤„ç†æ¨¡å—ï¼š
Read file: web/src/core/sse/fetch-stream.ts
ç°åœ¨è®©æˆ‘æŸ¥çœ‹StreamEventç±»å‹å®šä¹‰ï¼š
Read file: web/src/core/sse/StreamEvent.ts
è®©æˆ‘æŸ¥çœ‹workspaceé¡µé¢çš„SSEå¤„ç†é€»è¾‘ï¼š
Read file: web/src/app/workspace/[traceId]/page.tsx
åŸºäºæˆ‘çš„è¯¦ç»†åˆ†æï¼Œç°åœ¨å¯ä»¥ç»™å‡ºç¡®å®šçš„ç­”æ¡ˆï¼š

## ğŸ“‹ **SSEæ•°æ®æµæ¶æ„çš„å®Œæ•´åˆ†æ**

### ğŸ” **ç¡®å®šçš„ç»“è®º**ï¼š

**Storeè·å–çš„SSE Eventç¡®å®æœ‰ä¸­é—´å¤„ç†ç»„ä»¶ï¼Œä¸æ˜¯ç›´æ¥è¯»å–åç«¯SSE APIæ¥å£ã€‚æ•´ä¸ªæ•°æ®æµæœ‰å¤šä¸ªå¤„ç†å±‚æ¬¡ï¼š**

### ğŸ¯ **å®Œæ•´çš„SSEæ•°æ®æµæ¶æ„**ï¼š

#### **1. åç«¯SSE APIæ¥å£**
- **`POST /api/research/stream`** - åç«¯SSEç«¯ç‚¹
- è¿”å›åŸå§‹çš„Server-Sent Eventsæµ

#### **2. åº•å±‚SSEå¤„ç†æ¨¡å—**
- **`web/src/core/sse/fetch-stream.ts`** - æœ€åº•å±‚çš„SSEè§£æå™¨
  - å¤„ç†åŸå§‹HTTPå“åº”æµ
  - è§£æSSEæ ¼å¼ï¼ˆ`event: xxx\ndata: {...}\n\n`ï¼‰
  - è¿”å›`StreamEvent`å¯¹è±¡

#### **3. APIæŠ½è±¡å±‚**
- **`web/src/core/api/research-stream.ts`** - SSE APIå®¢æˆ·ç«¯
  - è°ƒç”¨`fetchStream()`è·å–åŸå§‹SSEæµ
  - è§£æJSONæ•°æ®ï¼š`parseSSEEvent()`
  - ç±»å‹è½¬æ¢ï¼šå°†åŸå§‹äº‹ä»¶è½¬æ¢ä¸ºå¼ºç±»å‹çš„`SSEEvent`
  - æä¾›ç±»å‹å®ˆå«å‡½æ•°ï¼ˆ`isNavigationEvent`ã€`isPlanGeneratedEvent`ç­‰ï¼‰

#### **4. ä¸šåŠ¡é€»è¾‘å¤„ç†å±‚**
- **`web/src/app/workspace/[traceId]/page.tsx`** - ä¸»è¦çš„SSEäº‹ä»¶å¤„ç†å™¨
  - è°ƒç”¨`createResearchStream()`è·å–ç±»å‹åŒ–äº‹ä»¶æµ
  - æ ¹æ®äº‹ä»¶ç±»å‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘
  - åˆ›å»ºMessageå¯¹è±¡å¹¶æ·»åŠ åˆ°store
  - å¤„ç†URLæ˜ å°„ã€çº¿ç¨‹ç®¡ç†ç­‰

#### **5. çŠ¶æ€ç®¡ç†å±‚**
- **`web/src/core/store/unified-store.ts`** - çŠ¶æ€å­˜å‚¨
  - ä¸ç›´æ¥å¤„ç†SSEäº‹ä»¶
  - æä¾›`addMessage`ã€`updateMessage`ç­‰æ–¹æ³•
  - å­˜å‚¨å¤„ç†åçš„ä¸šåŠ¡æ•°æ®

### ğŸš€ **æ•°æ®æµè·¯å¾„**ï¼š

```
åç«¯SSE API 
    â†“ (åŸå§‹SSEæµ)
fetch-stream.ts 
    â†“ (StreamEventå¯¹è±¡)
research-stream.ts 
    â†“ (å¼ºç±»å‹SSEEvent)
workspace/page.tsx 
    â†“ (ä¸šåŠ¡å¤„ç† + Messageåˆ›å»º)
unified-store.ts 
    â†“ (å­˜å‚¨çŠ¶æ€)
Reactç»„ä»¶ (é€šè¿‡hooksè·å–)
```

### ğŸ”§ **å…³é”®çš„ä¸­é—´å¤„ç†ç»„ä»¶**ï¼š

1. **`fetch-stream.ts`**ï¼š
   - åŸå§‹SSEåè®®è§£æ
   - å¤„ç†ç½‘ç»œæµå’Œç¼“å†²

2. **`research-stream.ts`**ï¼š
   - JSONè§£æå’Œç±»å‹è½¬æ¢
   - é”™è¯¯å¤„ç†å’Œé‡è¿é€»è¾‘
   - äº‹ä»¶ç±»å‹è¯†åˆ«

3. **`workspace/page.tsx`**ï¼š
   - æœ€é‡è¦çš„ä¸šåŠ¡é€»è¾‘å¤„ç†å±‚
   - å°†SSEäº‹ä»¶è½¬æ¢ä¸ºåº”ç”¨çŠ¶æ€
   - å¤„ç†å„ç§äº‹ä»¶ç±»å‹çš„å…·ä½“é€»è¾‘

### âœ… **ç»“è®º**ï¼š

**Storeå¹¶ä¸ç›´æ¥è¯»å–åç«¯SSE APIæ¥å£ï¼Œè€Œæ˜¯é€šè¿‡å¤šå±‚ä¸­é—´å¤„ç†ç»„ä»¶ï¼š**

1. **åº•å±‚ç½‘ç»œå¤„ç†** - `fetch-stream.ts`
2. **APIæŠ½è±¡å’Œç±»å‹åŒ–** - `research-stream.ts`  
3. **ä¸šåŠ¡é€»è¾‘å¤„ç†** - `workspace/page.tsx`
4. **çŠ¶æ€å­˜å‚¨** - `unified-store.ts`

è¿™ç§åˆ†å±‚æ¶æ„æä¾›äº†ï¼š
- **èŒè´£åˆ†ç¦»**ï¼šæ¯å±‚ä¸“æ³¨ç‰¹å®šåŠŸèƒ½
- **ç±»å‹å®‰å…¨**ï¼šä»åŸå§‹å­—ç¬¦ä¸²åˆ°å¼ºç±»å‹å¯¹è±¡
- **é”™è¯¯å¤„ç†**ï¼šæ¯å±‚éƒ½æœ‰ç›¸åº”çš„é”™è¯¯å¤„ç†
- **å¯æµ‹è¯•æ€§**ï¼šæ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- **å¯æ‰©å±•æ€§**ï¼šæ–°çš„äº‹ä»¶ç±»å‹æ˜“äºæ·»åŠ 